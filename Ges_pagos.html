<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bocatto | Checkout</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Tipografía del proyecto -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&display=swap" rel="stylesheet">

  <style>
    body { background:#111; color:#f7f7f7; }
    .navbar { font-family: 'Oswald', sans-serif; }
    .card { background:#1b1b1b; border:1px solid #2a2a2a; }
    .card .form-control, .card .form-select { background:#121212; color:#eaeaea; border-color:#3a3a3a; }
    .text-muted { color:#bdbdbd !important; }
    .price { color:#ff3b3b; font-weight:700; }
    .chip { background:#202020; border:1px solid #2b2b2b; border-radius:999px; padding:.25rem .6rem; font-size:.85rem; }
    .btn-danger { background:#e53935; border-color:#e53935; }
    .btn-outline-light { border-color:#ccc; color:#eee; }
    .btn-outline-light:hover { background:#eee; color:#111; }
    .divider { height:1px; background:#2b2b2b; margin:.75rem 0; }
    /* Tarjeta de pago visible solo cuando se selecciona "tarjeta" */
    #card-box { display:none; }
    /* Direcciones: cambia según tipo de entrega */
    #address-pickup, #address-delivery { display:none; }
    /* Scroll agrad. para listado */
    #resumen-items { max-height: 420px; overflow:auto; }

    /* === Ajustes según tu pantallazo (A=amarillo, N=negro) === */

/* Paleta */
:root { --yellow:#ffcc00; --black:#111; }

/* A) Las 2 cards de selección (Entrega y Pago) -> fondo amarillo + texto negro */
.col-lg-8 > .card:nth-of-type(1),
.col-lg-8 > .card:nth-of-type(2){
  background: var(--yellow);
  border-color: #f2c43b;
  color: var(--black);
}
.col-lg-8 > .card:nth-of-type(1) h5,
.col-lg-8 > .card:nth-of-type(2) h5,
.col-lg-8 > .card:nth-of-type(1) label,
.col-lg-8 > .card:nth-of-type(2) label,
.col-lg-8 > .card:nth-of-type(1) .text-muted,
.col-lg-8 > .card:nth-of-type(2) .text-muted{
  color: var(--black) !important;
}
/* Radios visibles sobre amarillo */
.col-lg-8 > .card:nth-of-type(1) .form-check-input,
.col-lg-8 > .card:nth-of-type(2) .form-check-input{ border-color: var(--black); }
.col-lg-8 > .card:nth-of-type(1) .form-check-input:checked,
.col-lg-8 > .card:nth-of-type(2) .form-check-input:checked{ background-color: var(--black); border-color: var(--black); }

/* A) Total del resumen en amarillo */
.price, #txt-total{ color: var(--yellow) !important; }

/* N) Botón “Confirmar pedido” en negro (cuando esté habilitado) */
#btn-confirmar{
  background: var(--black);
  border-color: var(--black);
  color:#fff;
}
#btn-confirmar:hover:not(:disabled){ opacity:.9; }
#btn-confirmar:disabled{ background:#000000; border-color:#333; color:#bbb; }

/* Inputs del bloque “Tarjeta”: blancos con texto negro (contraste) */
#card-box .form-control,
#card-box .form-select{ background:#fff; color:#111; border-color:#ccc; }
#card-box .form-control::placeholder{ color:#666; }
/* Por si el bloque tenía estilos inline oscuros */
#card-box{ background:#fff !important; border:1px solid #ddd !important; color:#111; }
#card-box h6{ color:#111; }

/* (Opcional) Marca Bocatto del navbar en amarillo */
.navbar-brand{ color: var(--yellow) !important; }

/* === Resumen de compra: fondo amarillo + letras negras === */
:root { --yellow:#ffcc00; --black:#111; }

/* Card de la columna derecha */
.col-lg-4 > .card{
  background: var(--yellow);
  border-color: #f2c43b;
  color: var(--black);
}

/* Forzar textos negros dentro del resumen */
.col-lg-4 > .card h5,
.col-lg-4 > .card .text-muted,
.col-lg-4 > .card span,
.col-lg-4 > .card a{
  color: var(--black) !important;
}

/* El total también en negro (por si antes lo dejaste amarillo/rojo) */
.col-lg-4 > .card #txt-total,
.col-lg-4 > .card .price{
  color: var(--black) !important;
}


  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-secondary">
  <div class="container">
    <a class="navbar-brand" href="Web_principal.html">
      <i class="bi bi-bag"></i> Bocatto
    </a>
    <div class="ms-auto d-flex gap-2">
      <a href="Web_principal.html" class="btn btn-outline-light">
        <i class="bi bi-arrow-left"></i> Volver a la tienda
      </a>
    </div>
  </div>
</nav>

<main class="container my-4">
  <div class="row g-4">
    <!-- Columna izquierda -->
    <div class="col-12 col-lg-8">

      <!-- Tipo de entrega -->
      <div class="card shadow-sm rounded-4 mb-3">
        <div class="card-body">
          <h5 class="mb-3">Tu tipo de entrega</h5>

          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="deliveryType" id="optRetiro" value="retiro">
            <label class="form-check-label" for="optRetiro">
              Retiro en local
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="radio" name="deliveryType" id="optDespacho" value="despacho">
            <label class="form-check-label" for="optDespacho">
              Despacho a domicilio
            </label>
          </div>

          <!-- Bloque dinámico de dirección -->
          <div class="mt-3 p-3 rounded-3" style="background:#151515; border:1px solid #2a2a2a;">
            <div id="address-pickup">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <div class="fw-semibold">LOCAL MAIPÚ</div>
                  <small class="text-muted d-block">Av. Pajaritos 1234, Maipú, RM, Chile</small>
                  <small class="text-muted d-block">¿Cómo llegar? • Tiempo de entrega <span class="chip">15 - 25 mins</span></small>
                </div>
                <button class="btn btn-outline-light btn-sm" id="btnElegirOtro">Elegir otro</button>
              </div>
            </div>

            <div id="address-delivery">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <div class="fw-semibold">Dirección para despacho</div>
                  <small class="text-muted d-block" id="delivery-address">Calle Falsa 123, Maipú, RM, Chile</small>
                </div>
                <button class="btn btn-outline-light btn-sm" id="btnCambiarDir">Cambiar dirección del pedido</button>
              </div>
            </div>

            <div id="address-hint" class="text-muted">Selecciona una opción de entrega para ver la dirección.</div>
          </div>
        </div>
      </div>

      <!-- Método de pago -->
      <div class="card shadow-sm rounded-4 mb-3">
        <div class="card-body">
          <h5 class="mb-3">Método de pago</h5>

          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="payMethod" id="optContra" value="contraentrega">
            <label class="form-check-label" for="optContra">
              Pago contra entrega
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="radio" name="payMethod" id="optTarjeta" value="tarjeta">
            <label class="form-check-label" for="optTarjeta">
              Tarjeta de Débito o Crédito
            </label>
          </div>

          <!-- Formulario de tarjeta (mock) -->
          <div id="card-box" class="mt-3 p-3 rounded-3" style="background:#151515; border:1px solid #2a2a2a;">
            <h6 class="mb-3">Datos de la tarjeta</h6>
            <div class="row g-2">
              <div class="col-12">
                <input type="text" id="card-number" class="form-control" placeholder="Número de tarjeta (16 dígitos)" maxlength="19">
              </div>
              <div class="col-6">
                <input type="text" id="card-mm" class="form-control" placeholder="Mes de vencimiento (MM)" maxlength="2">
              </div>
              <div class="col-6">
                <input type="text" id="card-yy" class="form-control" placeholder="Año de vencimiento (AA)" maxlength="2">
              </div>
              <div class="col-6">
                <input type="text" id="card-cvv" class="form-control" placeholder="CVV" maxlength="4">
              </div>
              <div class="col-12">
                <input type="text" id="card-name" class="form-control" placeholder="Nombre impreso en la tarjeta">
              </div>
              <div class="col-12 form-check mt-2">
                <input class="form-check-input" type="checkbox" id="save-card">
                <label class="form-check-label" for="save-card">Guardar para su uso posterior.</label>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Columna derecha -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h5 class="mb-3">Resumen de compra</h5>

          <div id="resumen-items" class="mb-3"></div>

          <div class="divider"></div>
          <div class="d-flex justify-content-between">
            <span class="text-muted">Subtotal</span>
            <span id="txt-subtotal">$0</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="text-muted" id="envio-label">Envío</span>
            <span id="txt-envio">$0</span>
          </div>
          <div class="d-flex justify-content-between align-items-center mt-2">
            <span class="fw-bold">Total Pedido</span>
            <span class="price" id="txt-total">$0</span>
          </div>

          <div class="mt-3 d-flex justify-content-between">
            <a href="Web_principal.html" class="link-light text-decoration-none">
              <i class="bi bi-chevron-left"></i> Volver al carrito
            </a>
          </div>

          <div class="d-grid mt-3">
            <button class="btn btn-danger btn-lg" id="btn-confirmar" disabled>Confirmar pedido</button>
          </div>

          <div id="empty-msg" class="text-center text-muted mt-3" style="display:none;">
            No hay artículos en tu carrito.
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Bootstrap bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
(() => {
  // --- Seguridad de acceso básico por rol (opcional suave) ---
  const role = localStorage.getItem('userRole') || 'visitante';
  if (role !== 'cliente') {
    // No bloqueo duro; pero si quieres redirigir, descomenta:
    // window.location.href = 'Web_principal.html';
  }

  // --- Carrito desde localStorage ---
  const CAR_KEY = 'carrito_bocatto';
  let carrito = [];
  try { carrito = JSON.parse(localStorage.getItem(CAR_KEY)) || []; } catch(e) { carrito = []; }

  // Elementos resumen
  const itemsBox   = document.getElementById('resumen-items');
  const txtSub     = document.getElementById('txt-subtotal');
  const txtEnvio   = document.getElementById('txt-envio');
  const txtTotal   = document.getElementById('txt-total');
  const emptyMsg   = document.getElementById('empty-msg');

  // Envío: 0 por ahora (según tu indicación y la referencia visual)
  let costoEnvio = 0;
  const fmt = n => n.toLocaleString('es-CL', { style:'currency', currency:'CLP' });

  function renderResumen() {
    itemsBox.innerHTML = '';
    if (carrito.length === 0) {
      emptyMsg.style.display = 'block';
      txtSub.textContent = fmt(0);
      txtEnvio.textContent = fmt(0);
      txtTotal.textContent = fmt(0);
      document.getElementById('btn-confirmar').disabled = true;
      return;
    }
    emptyMsg.style.display = 'none';

    let subtotal = 0;
    carrito.forEach(item => {
      const row = document.createElement('div');
      row.className = 'd-flex align-items-center border-bottom border-secondary-subtle py-2 gap-2';
      const subtotalItem = Number(item.precio) * Number(item.cantidad || 1);
      subtotal += subtotalItem;
      row.innerHTML = `
        <img src="${item.img || 'Recursos_Esteticos/img/default.jpg'}" alt="" class="rounded" style="width:56px;height:56px;object-fit:cover;">
        <div class="flex-grow-1">
          <div class="small fw-semibold">${item.nombre}</div>
          <div class="text-muted small">Cantidad: ${item.cantidad || 1}</div>
        </div>
        <div class="text-end small fw-semibold">${fmt(subtotalItem)}</div>
      `;
      itemsBox.appendChild(row);
    });

    txtSub.textContent = fmt(subtotal);
    txtEnvio.textContent = fmt(costoEnvio);
    txtTotal.textContent = fmt(subtotal + costoEnvio);
  }

  // --- Tipo de entrega ---
  const optRetiro   = document.getElementById('optRetiro');
  const optDespacho = document.getElementById('optDespacho');
  const addrPickup  = document.getElementById('address-pickup');
  const addrDeliv   = document.getElementById('address-delivery');
  const addrHint    = document.getElementById('address-hint');

  function setEntrega(tipo) {
    if (tipo === 'retiro') {
      addrPickup.style.display = 'block';
      addrDeliv.style.display  = 'none';
      addrHint.style.display   = 'none';
      costoEnvio = 0; // retiro no tiene envío
    } else if (tipo === 'despacho') {
      addrPickup.style.display = 'none';
      addrDeliv.style.display  = 'block';
      addrHint.style.display   = 'none';
      costoEnvio = 0; // por ahora 0 (como referencia). Si luego quieres, aquí puedes setear un valor.
    }
    renderResumen();
    validarHabilitar();
  }

  optRetiro?.addEventListener('change', () => setEntrega('retiro'));
  optDespacho?.addEventListener('change', () => setEntrega('despacho'));

  document.getElementById('btnElegirOtro')?.addEventListener('click', () => {
    alert('Próximamente podrás elegir otra sucursal.');
  });
  document.getElementById('btnCambiarDir')?.addEventListener('click', () => {
    alert('Próximamente podrás editar tu dirección.');
  });

  // --- Método de pago ---
  const optContra  = document.getElementById('optContra');
  const optTarjeta = document.getElementById('optTarjeta');
  const cardBox    = document.getElementById('card-box');

  optContra?.addEventListener('change', () => { cardBox.style.display = 'none'; validarHabilitar(); });
  optTarjeta?.addEventListener('change', () => { cardBox.style.display = 'block'; validarHabilitar(); });

  // Validación mínima de tarjeta
  function tarjetaValida() {
    const num = document.getElementById('card-number').value.replace(/\s+/g,'');
    const mm  = document.getElementById('card-mm').value;
    const yy  = document.getElementById('card-yy').value;
    const cvv = document.getElementById('card-cvv').value;
    const nm  = document.getElementById('card-name').value.trim();
    // súper simple: 16 dígitos, MM 01-12, AA 00-99, CVV 3-4, nombre no vacío
    const okNum = /^\d{16}$/.test(num);
    const okMM  = /^(0[1-9]|1[0-2])$/.test(mm);
    const okYY  = /^\d{2}$/.test(yy);
    const okCVV = /^\d{3,4}$/.test(cvv);
    return okNum && okMM && okYY && okCVV && nm.length > 1;
  }

  ['card-number','card-mm','card-yy','card-cvv','card-name'].forEach(id=>{
    const el = document.getElementById(id);
    el?.addEventListener('input', validarHabilitar);
  });

  // Habilita el botón Confirmar cuando:
  // - hay carrito
  // - hay un tipo de entrega seleccionado
  // - hay método de pago seleccionado
  // - si es tarjeta, la tarjeta es válida
  function validarHabilitar() {
    const btn = document.getElementById('btn-confirmar');
    const deliveryOk = optRetiro.checked || optDespacho.checked;
    const payOk = optContra.checked || (optTarjeta.checked && tarjetaValida());
    btn.disabled = !(carrito.length > 0 && deliveryOk && payOk);
  }

  document.getElementById('btn-confirmar')?.addEventListener('click', () => {
    // Por ahora sólo simulamos; en la siguiente interfaz haremos la "carga de pago".
    alert('✅ Método de pago confirmado. Listo para procesar el pedido.');
    // Aquí más adelante: window.location.href = 'Ges_carga_pago.html';
  });

  // Render inicial
  renderResumen();
})();
</script>
</body>
</html>
